{"version":3,"file":"commonHelpers.js","sources":["../src/gallery.js","../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nvar lightbox = new SimpleLightbox('.gallery a');\n\nexport default function resetGallery() {\n  lightbox.refresh();\n\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\nimport resetGallery from './gallery';\naxios.defaults.baseURL = 'https://pixabay.com/';\n\n\nconst elements = {\n  form: document.querySelector('#search-form'),\n  gallery: document.querySelector('.gallery'),\n};\n\n\nconst AppState = {\n  query: '',\n  page: 1,\n  loader: document.querySelector('.load-more'),\n  showLoader: function () {\n    this.loader.style.display = 'block';\n  },\n  hideLoader: function () {\n    this.loader.style.display = 'none';\n  },\n  updateQuery: function (newQuery) {\n    this.query = newQuery;\n  },\n  nextPage: function () {\n    this.page++;\n  },\n  resetPage: function () {\n    this.page = 1;\n  },\n};\n\nAppState.hideLoader()\n\nasync function fetchImages(q,page) {\n  return await axios.get('api/', {\n    params: {\n      key: '42155230-030ff0e38ddad02fbff1fc379',\n      page: page,\n      orientation: 'horizontal',\n      safesearch: true,\n      per_page: 40,\n      q: q,\n    },\n  });\n}\nfunction createGallery({ hits, total, totalHits }) {\n  return hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `\n      <a class=\"photo-card\" href=\"${largeImageURL}\">\n        <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n        <div class=\"info\">\n        <p class=\"info-item\">\n            <b>Likes</b>\n            ${likes}\n        </p>\n            <p class=\"info-item\">\n        <b>Views</b>\n        ${views}\n        </p>\n        <p class=\"info-item\">\n            <b>Comments</b>\n            ${comments}\n        </p>\n        <p class=\"info-item\">\n            <b>Downloads</b>\n            ${downloads}\n        </p>\n    </div>`;\n      }\n    )\n    .join('');\n}\n\n\nelements.form.addEventListener('submit', handleSubmitForm);\n\nfunction handleSubmitForm(e) {\n  e.preventDefault();\n\n  const { searchQuery } = e.currentTarget.elements;\n  const trimValue = searchQuery.value.trim();\n  if (!trimValue) return;\n  AppState.updateQuery(trimValue);\n  AppState.resetPage();\n  \n  handleFetchImages();\n  \n}\n\nasync function handleFetchImages() {\n  AppState.hideLoader();\n  try {\n    const { data } = await fetchImages(AppState.query, AppState.page);\n    if (!data.hits.length) {\n      elements.gallery.innerHTML = ''\n      iziToast.show({\n        color: 'red',\n        position: 'topRight',\n        message: `\"We're sorry, repeat search.\"`,\n      });\n      throw new Error('Error');\n    }\n    iziToast.show({\n      color: 'green',\n      position: 'topRight',\n      message: `\"Hooray! We found ${data.totalHits} images.\"`,\n    });\n    elements.gallery.innerHTML = createGallery(data);\n    observer.observe(AppState.loader);\n    resetGallery()\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n    AppState.showLoader();\n  } catch (error) {\n    console.log(error)\n  }\n}\n\nlet observer = new IntersectionObserver(handleObserve, {\n  rootMargin: '500px',\n});\n\n\nfunction handleObserve(entries, observer) {\n  entries.forEach((entry) => {\n    if (entry.isIntersecting) {\n      AppState.nextPage();\n      handleLoadMoreFetchImages();\n    }\n   })\n}\n\nasync function handleLoadMoreFetchImages() {\n\n   try {\n     const { data } = await fetchImages(AppState.query, AppState.page);\n     const pages = Math.ceil(data.totalHits / 40);\n     if (AppState.page > pages) {\n       AppState.hideLoader()\n       observer.unobserve(AppState.loader);\n       iziToast.show({\n         color: 'red',\n         position: 'topRight',\n         message: `\"We're sorry, but you've reached the end of search results.\"`,\n       });\n     }\n     else {\n       elements.gallery.insertAdjacentHTML('beforeend', createGallery(data));\n\n       const { height: cardHeight } =\n         elements.gallery.firstElementChild.getBoundingClientRect();\n       window.scrollBy({\n         top: cardHeight * 2.5,\n         behavior: 'smooth',\n       });\n       resetGallery();\n     }     \n    \n   } catch (error) {\n     console.log(error)\n  }\n\n}\n\n\n"],"names":["lightbox","SimpleLightbox","resetGallery","axios","elements","AppState","newQuery","fetchImages","q","page","createGallery","hits","total","totalHits","webformatURL","largeImageURL","tags","likes","views","comments","downloads","handleSubmitForm","searchQuery","trimValue","handleFetchImages","data","iziToast","observer","error","handleObserve","entries","entry","handleLoadMoreFetchImages","pages","cardHeight"],"mappings":"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"}